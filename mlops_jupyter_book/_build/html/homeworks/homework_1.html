

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>1. Homework 1 - Due 23rd May 2023 &#8212; DTC MlOps-Zoomcamp</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "tubbytim/mlops-zoomcamp");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "üí¨ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'homeworks/homework_1';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="DataTalksClub MlOps-Zoomcamp Jupyter Book" href="../intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/dtc.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/dtc.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    DataTalksClub MlOps-Zoomcamp Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">1. Homework 1 - Due 23rd May 2023</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/tubbytim/mlops-zoomcamp" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/tubbytim/mlops-zoomcamp/issues/new?title=Issue%20on%20page%20%2Fhomeworks/homework_1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/homeworks/homework_1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Homework 1 - Due 23rd May 2023</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q1-downloading-the-data">1.1. Q1. Downloading the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q2-computing-duration">1.2. Q2. Computing duration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q3-dropping-outliers">1.3. Q3. Dropping outliers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q4-one-hot-encoding">1.4. Q4. One-hot encoding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q5-training-a-model">1.5. Q5. Training a model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q6-evaluating-the-model">1.6. Q6. Evaluating the model</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="homework-1-due-23rd-may-2023">
<h1><span class="section-number">1. </span>Homework 1 - Due 23rd May 2023<a class="headerlink" href="#homework-1-due-23rd-may-2023" title="Permalink to this headline">#</a></h1>
<p>This notebook fulfills the requirements of Homework number 1 which is due on the 23rd of May 2023. The questions posed within the homework have been answered in markdown cells below.</p>
<p>The details for the homework can be found <a class="reference external" href="https://github.com/DataTalksClub/mlops-zoomcamp/blob/main/cohorts/2023/01-intro/homework.md">here</a> and a brief outline can be seen below:</p>
<div class="admonition-homework-1-outline admonition">
<p class="admonition-title">Homework 1 Outline</p>
<p>The goal of this homework is to train a simple model for predicting the duration of a ride.
We‚Äôll use the same NYC taxi dataset, but instead of ‚ÄúGreen Taxi Trip Records‚Äù, we‚Äôll use ‚ÄúYellow Taxi Trip Records‚Äù.
The data to be used is January and February 2022</p>
</div>
<div class="tip admonition">
<p class="admonition-title">Data Validation</p>
<p>I have included a small section below on data validation. This is extremely important as we would like our data to be as robust as possible and have the form expected before we begin training an ML model (dates not in the future, no negative values for fare or journey length etc.).</p>
<p>Creating a validation schema using <a class="reference external" href="https://pandera.readthedocs.io/en/stable/index.html">Pandera</a> is extremely easy and can be very powerful when it comes to data validation. Creating a schema that I thought was reasonable threw up some errors that I thought were interesting but investigating / remediating are outside the scope of this MLOps course:</p>
<ul class="simple">
<li><p>null values in passenger count</p></li>
<li><p>negative values for all amounts (fare, mta, tolls etc.)</p></li>
</ul>
</div>
<div class="cell tag_hide_output tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TaxiSchema</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">DataFrameModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Schema to validate our data against.</span>
<span class="sd">    This will ensure that any data we use for training and predictions has the correct form</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">VendorID</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tpep_pickup_datetime</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="n">DateTime</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">le</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="n">tpep_dropoff_datetime</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="n">DateTime</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">le</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="n">passenger_count</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">coerce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">trip_distance</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">RatecodeID</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">coerce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">store_and_fwd_flag</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">isin</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">PULocationID</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">DOLocationID</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">payment_type</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fare_amount</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span> <span class="c1"># fair amounts &lt;0 were identified. Going to assume they were refunds but should be investigated</span>
    <span class="n">extra</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">mta_tax</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">tip_amount</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">tolls_amount</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">improvement_surcharge</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">total_amount</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="n">congestion_surcharge</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">airport_fee</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">duration</span><span class="p">:</span> <span class="n">Series</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">pa</span><span class="o">.</span><span class="n">dataframe_check</span>
    <span class="k">def</span> <span class="nf">check_dates</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;tpep_pickup_datetime&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;tpep_dropoff_datetime&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="q1-downloading-the-data">
<h2><span class="section-number">1.1. </span>Q1. Downloading the data<a class="headerlink" href="#q1-downloading-the-data" title="Permalink to this headline">#</a></h2>
<p>Read the data for January. How many columns are there?</p>
<p><strong>Answer</strong></p>
<p>We can see in the table below there are 20 columns. I added the <code class="docutils literal notranslate"><span class="pre">duration</span></code> column so the answer is <strong>19 columns are read from the data</strong></p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style> table th {color: white;
    background: #204990; text-overflow: ellipsis; overflow: elipsis; font-size: 0.6vw; }
    table td { text-overflow: ellipsis; overflow: elipsis; font-size: 0.6vw;}</style>
<div class="itables">
<table id="1cfff88f-6cda-4aa0-9f63-6a1b8eb9c025" class="display compact"style="table-layout:auto;width:auto;max-width:100%;text-align:center;caption-side:bottom"><thead>
    <tr style="text-align: right;">
      
      <th>VendorID</th>
      <th>tpep_pickup_datetime</th>
      <th>tpep_dropoff_datetime</th>
      <th>passenger_count</th>
      <th>trip_distance</th>
      <th>RatecodeID</th>
      <th>store_and_fwd_flag</th>
      <th>PULocationID</th>
      <th>DOLocationID</th>
      <th>payment_type</th>
      <th>fare_amount</th>
      <th>extra</th>
      <th>mta_tax</th>
      <th>tip_amount</th>
      <th>tolls_amount</th>
      <th>improvement_surcharge</th>
      <th>total_amount</th>
      <th>congestion_surcharge</th>
      <th>airport_fee</th>
      <th>duration</th>
    </tr>
  </thead><tbody><tr><td>Loading... (need <a href=https://mwouts.github.io/itables/troubleshooting.html>help</a>?)</td></tr></tbody></table>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
<script type="module">
    // Import jquery and DataTable
    import 'https://code.jquery.com/jquery-3.6.0.min.js';
    import dt from 'https://cdn.datatables.net/1.12.1/js/jquery.dataTables.mjs';
    dt($);

    // Define the table data
    const data = [[1, "2022-01-01 00:35:40", "2022-01-01 00:53:29", 2.0, 3.8, 1.0, "N", "142", "236", 1, 14.5, 3.0, 0.5, 3.65, 0.0, 0.3, 21.95, 2.5, 0.0, 17.82], [1, "2022-01-01 00:33:43", "2022-01-01 00:42:07", 1.0, 2.1, 1.0, "N", "236", "42", 1, 8.0, 0.5, 0.5, 4.0, 0.0, 0.3, 13.3, 0.0, 0.0, 8.4], [2, "2022-01-01 00:53:21", "2022-01-01 01:02:19", 1.0, 0.97, 1.0, "N", "166", "166", 1, 7.5, 0.5, 0.5, 1.76, 0.0, 0.3, 10.56, 0.0, 0.0, 8.97], [2, "2022-01-01 00:25:21", "2022-01-01 00:35:23", 1.0, 1.09, 1.0, "N", "114", "68", 2, 8.0, 0.5, 0.5, 0.0, 0.0, 0.3, 11.8, 2.5, 0.0, 10.03], [2, "2022-01-01 00:36:48", "2022-01-01 01:14:20", 1.0, 4.3, 1.0, "N", "68", "163", 1, 23.5, 0.5, 0.5, 3.0, 0.0, 0.3, 30.3, 2.5, 0.0, 37.53]];

    // Define the dt_args
    let dt_args = {"autoWidth": false, "columnDefs": [{"className": "dt-center", "targets": "_all"}], "order": [], "dom": "t"};
    dt_args["data"] = data;

    $(document).ready(function () {
        
        $('#1cfff88f-6cda-4aa0-9f63-6a1b8eb9c025').DataTable(dt_args);
    });
</script>
</div>
</div></div>
</div>
</section>
<section id="q2-computing-duration">
<h2><span class="section-number">1.2. </span>Q2. Computing duration<a class="headerlink" href="#q2-computing-duration" title="Permalink to this headline">#</a></h2>
<p>Now let‚Äôs compute the duration variable. It should contain the duration of a ride in minutes.</p>
<p>What‚Äôs the standard deviation of the trips duration in January?</p>
<p><strong>Answer</strong></p>
<p>Using the describe method we can see that the standard deviation od the <code class="docutils literal notranslate"><span class="pre">duration</span></code> column is <strong>46.45 minutes.</strong></p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style> table th {color: white;
    background: #204990; text-overflow: ellipsis; overflow: elipsis; font-size: 0.6vw; }
    table td { text-overflow: ellipsis; overflow: elipsis; font-size: 0.6vw;}</style>
<div class="itables">
<table id="2c0882ce-314d-47ac-acaf-e640e8e9522d" class="display compact"style="table-layout:auto;width:auto;max-width:100%;text-align:center;caption-side:bottom"><thead>
    <tr style="text-align: right;">
      <th></th>
      <th>VendorID</th>
      <th>passenger_count</th>
      <th>trip_distance</th>
      <th>RatecodeID</th>
      <th>payment_type</th>
      <th>fare_amount</th>
      <th>extra</th>
      <th>mta_tax</th>
      <th>tip_amount</th>
      <th>tolls_amount</th>
      <th>improvement_surcharge</th>
      <th>total_amount</th>
      <th>congestion_surcharge</th>
      <th>airport_fee</th>
      <th>duration</th>
    </tr>
  </thead><tbody><tr><td>Loading... (need <a href=https://mwouts.github.io/itables/troubleshooting.html>help</a>?)</td></tr></tbody></table>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
<script type="module">
    // Import jquery and DataTable
    import 'https://code.jquery.com/jquery-3.6.0.min.js';
    import dt from 'https://cdn.datatables.net/1.12.1/js/jquery.dataTables.mjs';
    dt($);

    // Define the table data
    const data = [["count", 2463931.0, 2392428.0, 2463931.0, 2392428.0, 2463931.0, 2463931.0, 2463931.0, 2463931.0, 2463931.0, 2463931.0, 2463931.0, 2463931.0, 2392428.0, 2392428.0, 2463931.0], ["mean", 1.71, 1.39, 5.37, 1.42, 1.19, 12.95, 1.01, 0.49, 2.39, 0.37, 0.3, 19.17, 2.28, 0.08, 14.21], ["std", 0.5, 0.98, 547.87, 5.92, 0.5, 255.81, 1.24, 0.08, 2.83, 1.68, 0.04, 255.96, 0.74, 0.31, 46.45], ["min", 1.0, 0.0, 0.0, 1.0, 0.0, -480.0, -4.5, -0.5, -125.22, -31.4, -0.3, -480.3, -2.5, -1.25, -3442.4], ["25%", 1.0, 1.0, 1.04, 1.0, 1.0, 6.5, 0.0, 0.5, 0.72, 0.0, 0.3, 11.3, 2.5, 0.0, 6.32], ["50%", 2.0, 1.0, 1.74, 1.0, 1.0, 9.0, 0.5, 0.5, 2.0, 0.0, 0.3, 14.69, 2.5, 0.0, 10.18], ["75%", 2.0, 1.0, 3.13, 1.0, 1.0, 14.0, 2.5, 0.5, 3.0, 0.0, 0.3, 20.02, 2.5, 0.0, 16.17], ["max", 6.0, 9.0, 306159.28, 99.0, 5.0, 401092.32, 33.5, 16.59, 888.88, 193.3, 0.3, 401095.62, 2.5, 1.25, 8513.18]];

    // Define the dt_args
    let dt_args = {"columnDefs": [{"className": "dt-center", "targets": "_all"}], "order": [], "dom": "t"};
    dt_args["data"] = data;

    $(document).ready(function () {
        
        $('#2c0882ce-314d-47ac-acaf-e640e8e9522d').DataTable(dt_args);
    });
</script>
</div>
</div></div>
</div>
</section>
<section id="q3-dropping-outliers">
<h2><span class="section-number">1.3. </span>Q3. Dropping outliers<a class="headerlink" href="#q3-dropping-outliers" title="Permalink to this headline">#</a></h2>
<p>Next, we need to check the distribution of the duration variable. There are some outliers. Let‚Äôs remove them and keep only the records where the duration was between 1 and 60 minutes (inclusive).</p>
<p>What fraction of the records left after you dropped the outliers?</p>
<p><strong>Answer</strong></p>
<p>The fraction of records remaining after excluding those outliers is <strong>98.28%</strong></p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of Rows Before: 2463931
Number of Rows After: 2421440
Fraction of Records Remain: 98.28%
</pre></div>
</div>
</div>
</div>
</section>
<section id="q4-one-hot-encoding">
<h2><span class="section-number">1.4. </span>Q4. One-hot encoding<a class="headerlink" href="#q4-one-hot-encoding" title="Permalink to this headline">#</a></h2>
<p>Let‚Äôs apply one-hot encoding to the pickup and dropoff location IDs. We‚Äôll use only these two features for our model.</p>
<p>Turn the dataframe into a list of dictionaries
Fit a dictionary vectorizer
Get a feature matrix from it
What‚Äôs the dimensionality of this matrix (number of columns)?</p>
<p><strong>Answer</strong></p>
<p>The dimensionality of the DictVectorizer after applying <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> is <strong>515</strong></p>
<div class="cell tag_hide_cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_indep</span> <span class="o">=</span> <span class="n">jan_df_no_outliers</span><span class="p">[</span><span class="n">INDEP_VARS</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;records&#39;</span><span class="p">)</span>
<span class="n">df_dep</span> <span class="o">=</span> <span class="n">jan_df_no_outliers</span><span class="p">[</span><span class="n">TARGET_VAR</span><span class="p">]</span>

<span class="n">d_vect</span> <span class="o">=</span> <span class="n">DictVectorizer</span><span class="p">()</span>
<span class="n">df_indep_trans</span> <span class="o">=</span> <span class="n">d_vect</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_indep</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of features after using the DictVectorizer class is: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">d_vect</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of features after using the DictVectorizer class is: 515
</pre></div>
</div>
</div>
</div>
</section>
<section id="q5-training-a-model">
<h2><span class="section-number">1.5. </span>Q5. Training a model<a class="headerlink" href="#q5-training-a-model" title="Permalink to this headline">#</a></h2>
<p>Now let‚Äôs use the feature matrix from the previous step to train a model.</p>
<p>Train a plain linear regression model with default parameters
Calculate the RMSE of the model on the training data
What‚Äôs the RMSE on train?</p>
<p><strong>Answer</strong></p>
<div class="cell tag_hide_cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_indep_trans</span><span class="p">,</span> <span class="n">df_dep</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The RMSE of the trained model on the training set is </span><span class="si">{</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">df_dep</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_indep_trans</span><span class="p">),</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The RMSE of the trained model on the training set is 6.986190836477672
</pre></div>
</div>
</div>
</div>
</section>
<section id="q6-evaluating-the-model">
<h2><span class="section-number">1.6. </span>Q6. Evaluating the model<a class="headerlink" href="#q6-evaluating-the-model" title="Permalink to this headline">#</a></h2>
<p>Now let‚Äôs apply this model to the validation dataset (February 2022).</p>
<p>What‚Äôs the RMSE on validation?</p>
<p><strong>Answer</strong></p>
<p>The RMSE on the validation set is <strong>7.79</strong></p>
<div class="cell tag_hide_cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feb_df_filtered</span> <span class="o">=</span> <span class="n">remove_outliers</span><span class="p">(</span><span class="n">feb_df</span><span class="p">,</span> <span class="n">DURATION_FILTER</span><span class="p">)</span>
<span class="n">df_val_indep_trans_feb</span> <span class="o">=</span> <span class="n">d_vect</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">feb_df_filtered</span><span class="p">[</span><span class="n">INDEP_VARS</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">))</span>
<span class="n">df_dep_feb</span> <span class="o">=</span> <span class="n">feb_df_filtered</span><span class="p">[</span><span class="n">TARGET_VAR</span><span class="p">]</span>
<span class="n">val_preds</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_val_indep_trans_feb</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The RMSE of the trained model on the training set is </span><span class="si">{</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">df_dep_feb</span><span class="p">,</span> <span class="n">val_preds</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The RMSE of the trained model on the training set is 7.78640879016696
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./homeworks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">DataTalksClub MlOps-Zoomcamp Jupyter Book</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q1-downloading-the-data">1.1. Q1. Downloading the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q2-computing-duration">1.2. Q2. Computing duration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q3-dropping-outliers">1.3. Q3. Dropping outliers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q4-one-hot-encoding">1.4. Q4. One-hot encoding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q5-training-a-model">1.5. Q5. Training a model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#q6-evaluating-the-model">1.6. Q6. Evaluating the model</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sean Hickey
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>